[core]
class: customUnitMetadata
showInEditor: true
availableInDemo: true
techLevel: 1
name: Gate
displayText: Teleportation Gate
displayText_ru: Врата телепорта
displayDescription: -Allow teleport units
displayDescription_ru: -Позволяет телепортировать юнитов
price: Pixels=10000
maxHp: 1000
mass: 99999
selfRegenRate: 0
buildSpeed: 15s
radius: 25
softCollisionOnAll: 100
isBio: false
isBuilding: true
maxTransportingUnits: 10
transportUnitsAddUnloadOption:false
tags: gate, Tp
autoTriggerCooldownTime: 0.1s
exit_moveAwayAmount: 10

[hiddenAction_spawnMark1]
@define g:1
autoTrigger:if self.hasUnitInTeam(withTag="spawnMark${g}") and not self.tags(includes="spawnMark${g}") and self.tags(includes="G${g}")
attachments_addNewUnits:Mark

[hiddenAction_spawnMark2]
@define g:2
@copyFromSection:hiddenAction_spawnMark1

[hiddenAction_spawnMark3]
@define g:3
@copyFromSection:hiddenAction_spawnMark1

[hiddenAction_spawnMark4]
@define g:4
@copyFromSection:hiddenAction_spawnMark1

[hiddenAction_removeMark1]
@define g:1
autoTrigger:if self.noUnitInTeam(withTag="spawnMark${g}") and self.tags(includes="G${g}")
attachments_deleteNumUnits:1

[hiddenAction_removeMark2]
@define g:2
@copyFromSection:hiddenAction_removeMark1

[hiddenAction_removeMark3]
@define g:3
@copyFromSection:hiddenAction_removeMark1

[hiddenAction_removeMark4]
@define g:4
@copyFromSection:hiddenAction_removeMark1

[hiddenAction_transport]
autoTrigger:If not self.tags(includes="G1") and not self.tags(includes="G2") and not self.tags(includes="G3") and not self.tags(includes="G4")
forceUnloadTransportNow:true

[attachment_mark]
x:0
y:0
isUnselectable:true
canBeAttackedAndDamaged: true

[hiddenAction_addSpawnTag1]
@define g:1
autoTrigger: if self.transportingCount(greaterThan=0) and self.tags(includes="G${g}")
temporarilyAddTags:spawnMark${g}

[hiddenAction_addSpawnTag2]
@define g:2
@copyFromSection:hiddenAction_addSpawnTag1

[hiddenAction_addSpawnTag23]
@define g:3
@copyFromSection:hiddenAction_addSpawnTag1

[hiddenAction_addSpawnTag4]
@define g:4
@copyFromSection:hiddenAction_addSpawnTag1

[hiddenAction_removeSpawnTag]
autoTrigger: if self.transportingCount(lessThan=1)
temporarilyRemoveTags:spawnMark1, spawnMark2, spawnMark3,SpawnMark4

[action_reset]
text_ru:Сбросить линию связи
displayType:action
allowMultipleInQueue: false
buildSpeed:0
canPlayerCancel: false
alwaysSinglePress: true
isVisible:if self.tags(includes="G1") or self.tags(includes="G2") or self.tags(includes="G3") or self.tags(includes="G4")
resetToDefaultTags:true
pos:0

[action_tp1]
@define g:1
isVisible: if not self.tags(includes="G${g}") and numberOfUnitsInTeam(withTag="G${g}", lessThan=2)
text: Establish a connection: ${g}
text_ru: Установить связь: ${g}
resetToDefaultTags:true
temporarilyAddTags:G${g}
allowMultipleInQueue: false
buildSpeed:0
canPlayerCancel: false
alwaysSinglePress: true
pos:${g}
displayType:action

[action_activeTp1]
@define g:1
@copyFromSection:action_tp1
isVisible:if self.tags(includes="G${g}")
text: Is active: ${g}
text_ru:Активировано: ${g}
temporarilyAddTags:NONE
resetToDefaultTags:false
displayType:NONE 

[action_tp2]
@define g:2
@copyFromSection:action_tp1

[action_activeTp2]
@define g:2
@copyFromSection:action_activeTp1

[action_tp3]
@define g:3
@copyFromSection:action_tp1

[action_activeTp3]
@define g:3
@copyFromSection:action_activeTp1

[action_tp4]
@define g:4
@copyFromSection:action_tp1

[action_activeTp4]
@define g:4
@copyFromSection:action_activeTp1

[hiddenAction_tp1Limit]
@define g:1
autoTrigger:if numberOfUnitsInTeam(withTag="G${g}", greaterThan=2)
temporarilyRemoveTags:G${g}
showMessageToPlayer: The maximum number of teleports with the same communication line is 2
showMessageToPlayer_ru: Максимальное количество телепортов с одинаковой линией связи - 2

[hiddenAction_tp2Limit]
@define g:2
@copyFromSection:hiddenAction_tp1Limit

[hiddenAction_tp3Limit]
@define g:3
@copyFromSection:hiddenAction_tp1Limit

[hiddenAction_tp4Limit]
@define g:4
@copyFromSection:hiddenAction_tp1Limit

[graphics]
showTransportBar:false
total_frames:2
image: Teleport.png 
imageScale:1

[attack]
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits: true
canAttackUnderwaterUnits: false
turretSize: 0
turretTurnSpeed: 999
maxAttackRange: 99999
shootDelay:0

[turret_G1]
@define tp:1
x:0
y:0
projectile:tp
canOnlyAttackUnitsWithTags:tp${tp}
canAttackCondition: if self.tags(includes="G${tp}")

[turret_G2]
@define tp:2
@copyFromSection:turret_G1

[turret_G3]
@define tp:3
@copyFromSection:turret_G1

[turret_G24]
@define tp:4
@copyFromSection:turret_G1

[projectile_tp]
life: 10
instant: true
directDamage:0
unloadUpToXUnitsFromSource: 10
explodeEffect:NONE

[movement]
movementType:LAND
moveSpeed: 0.5
moveAccelerationSpeed: 0.1
moveDecelerationSpeed: 0.1
reverseSpeedPercentage:0
maxTurnSpeed: 1
turnAcceleration: 0.1